<div class="admin-apps-page">
  <div class="d-flex justify-content-between align-items-start gap-2 flex-wrap mb-3">
    <div>
      <h4 class="mb-1">Catalogo Global de Apps</h4>
      <p class="text-muted mb-0">Aqui creas/publicas apps para que los clientes las instalen.</p>
    </div>
    <button class="btn btn-outline-secondary btn-sm" (click)="reload()" [disabled]="loading">Actualizar</button>
  </div>

  <div class="card mb-3">
    <div class="card-body">
      <h6 class="mb-3">Nueva app</h6>
      <form [formGroup]="appForm" (ngSubmit)="createApp()">
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label">Slug</label>
            <input class="form-control" formControlName="slug" placeholder="catalog-sync-api" />
          </div>
          <div class="col-md-4">
            <label class="form-label">Nombre</label>
            <input class="form-control" formControlName="name" />
          </div>
          <div class="col-md-4">
            <label class="form-label">Version</label>
            <input class="form-control" formControlName="version" />
          </div>
          <div class="col-md-6">
            <label class="form-label">Descripcion</label>
            <input class="form-control" formControlName="description" />
          </div>
          <div class="col-md-3">
            <label class="form-label">Categoria</label>
            <input class="form-control" formControlName="category" />
          </div>
          <div class="col-md-3">
            <label class="form-label">Icon</label>
            <input class="form-control" formControlName="icon" />
          </div>
          <div class="col-md-6">
            <label class="form-label">Config schema (JSON)</label>
            <textarea class="form-control json-editor" rows="6" formControlName="config_schema"></textarea>
          </div>
          <div class="col-md-6">
            <label class="form-label">Config default (JSON)</label>
            <textarea class="form-control json-editor" rows="6" formControlName="default_config"></textarea>
          </div>
        </div>
        <div class="mt-3 d-flex justify-content-end">
          <button class="btn btn-primary" type="submit">Crear app</button>
        </div>
      </form>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <h6 class="mb-3">Apps registradas</h6>
      <div class="table-responsive">
        <table class="table align-middle">
          <thead>
            <tr>
              <th>App</th>
              <th>Slug</th>
              <th>Version</th>
              <th>Estado</th>
              <th class="text-end">Acciones</th>
            </tr>
          </thead>
          <tbody>
            @for (app of apps; track app) {
              <tr>
                <td>{{ app.name }}</td>
                <td><code>{{ app.slug }}</code></td>
                <td>{{ app.version }}</td>
                <td>
                  <span class="badge" [class.bg-success]="app.is_active" [class.bg-secondary]="!app.is_active">
                    {{ app.is_active ? 'Publicada' : 'Oculta' }}
                  </span>
                </td>
                <td class="text-end">
                  <button class="btn btn-sm btn-outline-primary" (click)="toggleActive(app)">
                    {{ app.is_active ? 'Ocultar' : 'Publicar' }}
                  </button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
